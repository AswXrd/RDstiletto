'use client'
import {useState} from 'react'
const API=process.env.NEXT_PUBLIC_API_BASE||'http://localhost:8080'
export default function Home(){
 const [pubkey,setPubkey]=useState(''); const [homeIp,setHomeIp]=useState(''); const [projectId,setProjectId]=useState('sesac-effi3elov3'); const [projectName,setProjectName]=useState('knu-effi3elov3'); const [region,setRegion]=useState('asia-northeast3'); const [zone,setZone]=useState('asia-northeast3-a'); const [machineType,setMachineType]=useState('e2-micro'); const [sshUser,setSshUser]=useState('ubuntu'); const [rootEnabled,setRootEnabled]=useState(false); const [rootPassword,setRootPassword]=useState(''); const [status,setStatus]=useState(''); const [outputs,setOutputs]=useState<any>(null);
 const detectIp=async()=>{try{const r=await fetch('https://api.ipify.org?format=json'); const d=await r.json(); setHomeIp(d.ip)}catch{alert('IP 탐지 실패')}};
 const deploy=async()=>{setStatus('Deploying...'); try{const r=await fetch(`${API}/deploy`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({project_id:projectId,region,zone,project_name:projectName,home_cidr:`${homeIp}/32`,ssh_username:sshUser,public_key:pubkey,machine_type:machineType,set_root_password:rootEnabled,root_password:rootPassword,enable_cloud_logging:true})}); const d=await r.json(); setOutputs(d); setStatus('Done.')}catch(e:any){setStatus('Error: '+e.message)}};
 return (<div style={{maxWidth:960}}><h1>Deploy</h1><pre>ssh-keygen -t ed25519 -C "stiletto" -f ~/.ssh/stiletto</pre><textarea placeholder='ssh-ed25519 AAAA...' value={pubkey} onChange={e=>setPubkey(e.target.value)} style={{width:'100%',height:100}}/><h3>현재 IP</h3><div style={{display:'flex',gap:8}}><input placeholder='203.0.113.45' value={homeIp} onChange={e=>setHomeIp(e.target.value)}/><button onClick={detectIp}>Detect</button></div><h3>필수</h3><div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8}}><input value={projectId} onChange={e=>setProjectId(e.target.value)}/><input value={projectName} onChange={e=>setProjectName(e.target.value)}/><input value={region} onChange={e=>setRegion(e.target.value)}/><input value={zone} onChange={e=>setZone(e.target.value)}/><input value={sshUser} onChange={e=>setSshUser(e.target.value)}/><input value={machineType} onChange={e=>setMachineType(e.target.value)}/></div><details><summary>루트 옵션</summary><label><input type='checkbox' checked={rootEnabled} onChange={e=>setRootEnabled(e.target.checked)}/> set_root_password</label>{rootEnabled&&<input type='password' value={rootPassword} onChange={e=>setRootPassword(e.target.value)}/>}</details><div style={{marginTop:12}}><button onClick={deploy}>Deploy</button></div>{status&&<p>Status: {status}</p>}{outputs&&<pre style={{background:'#16161a',padding:12}}>{JSON.stringify(outputs,null,2)}</pre>}</div>) }